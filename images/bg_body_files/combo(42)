YUI.add("flickr-groups-addBlast-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-groups-addBlast"]={run:function(a,s){var l,r,u,d,i,o={};return o.group_id=a.id,o.blast=a.blast,o.user_id=a.user,o.extras="gimme_blast",e.Promise.all([s.callAPI("flickr.groups.addBlast",o),s.getModelRegistry("group-blast-models"),s.getModel("person-models",a.user)]).then(function(t){return l=t[0],r=t[1],d=t[2],u=l.group.newBlastSecure.content,i=l.group.newBlast.content,r.setValue(a.id,"blastMessage",i),r.setValue(a.id,"blastMessageSecure",u),r.setValue(a.id,"blastDateAdded",e.moment(l.group.dateBlastAdded.toString(),"X")),r.setValue(a.id,"blastUserName",d.getValue("username")),r.setValue(a.id,"blastPathAlias",d.getValue("pathAlias")),r.setValue(a.id,"blastUserNSID",d.getValue("nsid")),r.setValue(a.id,"blastRealName",d.getValue("realname")),r.setValue(a.id,"blastUserStatus",a.status),u},e.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise","moment"],optional:[]});YUI.add("group-blast-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-groups-getInfo"].run(e,this.appContext)},update:function(e,r){return t.ModelUpdaters["flickr-groups-addBlast"].run(e,r)}},attributes:{blastMessage:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:""},blastMessageSecure:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:""},blastDateAdded:{validator:function(e){return t.AttributeHelpers.validateDate(e)},setter:function(e){return t.AttributeHelpers.coerceDate(e)},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")}},blastUserName:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:""},blastPathAlias:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:""},blastUserNSID:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:""},blastRealName:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:""},blastUserStatus:{},blastUserUrl:{readOnly:!0,derivedBy:["blastPathAlias","blastUserNSID"],defaultFn:function(t){var e=this.getValue(t,"blastPathAlias");return e||(e=this.getValue(t,"blastUserNSID")),"/photos/"+e}},blastDisplayName:{readOnly:!0,derivedBy:["blastUserName"],defaultFn:function(t){return this.getValue(t,"blastUserName")}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-getInfo-fetcher","flickr-groups-addBlast-updater","attribute-helpers"]});YUI.add("flickr-groups-updateViewDate-updater",function(e,r){"use strict";e.namespace("ModelUpdaters")["flickr-groups-updateViewDate"]={run:function(t,u){return u.callAPI("flickr.groups.updateViewDate",t).then(null,e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("group-activity-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-groups-getInfo"].run(t,this.appContext)},updateViewDate:function(t,i){return e.ModelUpdaters["flickr-groups-updateViewDate"].run(t,i)}},groupViewed:function(t,i){"pool"===t.type?this.setValue(t.group_id,"viewedPool",e.moment()):"discussion"===t.type&&this.setValue(t.group_id,"viewedDiscussions",e.moment()),this.remote.updateViewDate(t,i)},getDefaultViewedDate:function(){return e.moment().subtract(13,"days")},attributes:{viewedDiscussions:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},defaultFn:function(e){return this.getDefaultViewedDate()},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},viewedPool:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},defaultFn:function(e){return this.getDefaultViewedDate()},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},latestViewedDate:{readOnly:!0,derivedBy:["viewedDiscussions","viewedPool"],getter:function(t,i){var r=this.getValue(i,"viewedPool"),u=this.getValue(i,"viewedDiscussions");return e.moment.max(u,r)}},hasNewActivity:{readOnly:!0,derivedBy:["latestViewedDate","group"],defaultFn:function(t){var i=this.getValue(t,"latestViewedDate"),r=this.getValue(t,"group").getValue("latestDiscussionActivity"),u=this.getValue(t,"group").getValue("latestPhotoActivity"),n=e.moment.max(u,r),o=i.clone().add(2,"w");return n.diff(i)>0&&n.diff(o)<0}},group:{isModel:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-updateViewDate-updater","flickr-people-getInfo-fetcher"]});