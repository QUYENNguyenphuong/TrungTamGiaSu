YUI.add("tag-route",function(e){function a(e){a.superclass.constructor.call(this,e)}e.Routes[this.name]=a,e.extend(a,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(a,t){if(!this.appContext.flipper.isFlipped("rebootify-tags"))return this.displayServerErrorOrClientRedirect(a,"You don't have the 'rebootify-tags' flipper flipped on");var r,s,i,l,o,p,n=a.params.tag_list,g=this,h=!1,c=!1,u=this.getPageNumber(a),d="/photos/tags/"+n+"/",m={},v={},P=[];if(v[e.SearchHelper.API.text]=n,m[e.SearchHelper.API.sort]=e.SearchHelper.API_SORT_OPTIONS.interesting,m[e.SearchHelper.API.safeSearch]=1,i=new e.SearchUrl(e.merge(m,v),this.appContext,e.SearchUrl.searchTypes.PHOTOS),p=i.getId(),!YUI.Env.isServer)try{var f=this.appContext.flapp.get("activeView");f.showAllDaily&&(c=!0),f.showAllWeekly&&(h=!0),"photo-page-scrappy-view"===f.name&&(r=f.nsid)}catch(e){}return s={page:1*(u-1)+1,perPage:50,apiParams:i.getAPIParams()},this.appContext.flipper.isFlipped("enable-v2-public-searches")&&(s.useV2API=!0),P.push(this.appContext.getModel("search-photos-lite-models",p,s)),e.Promise.all(P).then(function(t){var i=t[0];return i.getValue("totalItems")>4e3&&i.setValue("totalItems",4e3),YUI.Env.isServer&&(o=Math.ceil(i.getValue("totalItems")/50),u>o&&s.page>1&&!isNaN(parseInt(a.params.page_number,10)))?e.Promise.resolve({redirect:d.replace(/page[0-9]+/,"")}):(l=1*(u-1)+1,e.Promise.resolve({view:"tag-page-view",params:{tag:n,nsid:p,viewerNsid:a.probableUser||g.appContext.getViewer().nsid,comingFromNsid:r,showTodayTrending:c,showWeeklyTrending:h,pageParams:{page:l,perPage:50,viewPageSize:50,nominalPage:u},baseURL:d},title:g.intlMessage({intlName:"tags.TAG_PAGE_TITLE_ALT",tag:n}),layout:"scrolling"}))},function(t){var r="Couldn't load tag page";if(t.message&&(r+=": "+t.message),t.fatal)throw t;return g.displayRouteErrors(a,new e.RouteError(404,r))})}}),e.mix(a.prototype,e.Localizable)},"@VERSION@",{requires:["flickr-route","flickr-promise","tag-page-view","search-helper"],langBundles:["common","tags"]});